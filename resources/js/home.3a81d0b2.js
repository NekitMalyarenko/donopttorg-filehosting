(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["home"],{"1af6":function(e,t,n){var i=n("63b6");i(i.S,"Array",{isArray:n("9003")})},"20fd":function(e,t,n){"use strict";var i=n("d9f6"),r=n("aebd");e.exports=function(e,t,n){t in e?i.f(e,t,r(0,n)):e[t]=n}},"31d5":function(e,t,n){"use strict";var i=n("8148"),r=n.n(i);r.a},3607:function(e,t,n){},"549b":function(e,t,n){"use strict";var i=n("d864"),r=n("63b6"),o=n("241e"),s=n("b0dc"),a=n("3702"),c=n("b447"),u=n("20fd"),l=n("7cd6");r(r.S+r.F*!n("4ee1")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,r,f,h=o(e),d="function"==typeof this?this:Array,v=arguments.length,b=v>1?arguments[1]:void 0,p=void 0!==b,g=0,m=l(h);if(p&&(b=i(b,v>2?arguments[2]:void 0,2)),void 0==m||d==Array&&a(m))for(t=c(h.length),n=new d(t);t>g;g++)u(n,g,p?b(h[g],g):h[g]);else for(f=m.call(h),n=new d;!(r=f.next()).done;g++)u(n,g,p?s(f,b,[r.value,g],!0):r.value);return n.length=g,n}})},"54a1":function(e,t,n){n("6c1c"),n("1654"),e.exports=n("95d5")},"75fc":function(e,t,n){"use strict";var i=n("a745"),r=n.n(i);function o(e){if(r()(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}var s=n("774e"),a=n.n(s),c=n("c8bb"),u=n.n(c);function l(e){if(u()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return a()(e)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(e){return o(e)||l(e)||f()}n.d(t,"a",function(){return h})},"774e":function(e,t,n){e.exports=n("d2d5")},8148:function(e,t,n){},"85fe":function(e,t,n){"use strict";(function(e){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(function(){function e(e){this.value=e}function t(t){var n,i;function r(e,t){return new Promise(function(r,s){var a={key:e,arg:t,resolve:r,reject:s,next:null};i?i=i.next=a:(n=i=a,o(e,t))})}function o(n,i){try{var r=t[n](i),a=r.value;a instanceof e?Promise.resolve(a.value).then(function(e){o("next",e)},function(e){o("throw",e)}):s(r.done?"return":"normal",r.value)}catch(c){s("throw",c)}}function s(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1});break}n=n.next,n?o(n.key,n.arg):i=null}this._invoke=r,"function"!==typeof t.return&&(this.return=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};function s(e){var t=void 0;return t="function"===typeof e?{callback:e}:e,t}function a(e,t){var n=void 0,i=void 0,r=void 0,s=function(s){for(var a=arguments.length,c=Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];r=c,n&&s===i||(i=s,clearTimeout(n),n=setTimeout(function(){e.apply(void 0,[s].concat(o(r))),n=0},t))};return s._clear=function(){clearTimeout(n)},s}function c(e,t){if(e===t)return!0;if("object"===("undefined"===typeof e?"undefined":n(e))){for(var i in e)if(!c(e[i],t[i]))return!1;return!0}return!1}var u=function(){function e(t,n,r){i(this,e),this.el=t,this.observer=null,this.frozen=!1,this.createObserver(n,r)}return r(e,[{key:"createObserver",value:function(e,t){var n=this;this.observer&&this.destroyObserver(),this.frozen||(this.options=s(e),this.callback=this.options.callback,this.callback&&this.options.throttle&&(this.callback=a(this.callback,this.options.throttle)),this.oldResult=void 0,this.observer=new IntersectionObserver(function(e){var t=e[0];if(n.callback){var i=t.isIntersecting&&t.intersectionRatio>=n.threshold;if(i===n.oldResult)return;n.oldResult=i,n.callback(i,t),i&&n.options.once&&(n.frozen=!0,n.destroyObserver())}},this.options.intersection),t.context.$nextTick(function(){n.observer.observe(n.el)}))}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&this.options.intersection.threshold||0}}]),e}();function l(e,t,n){var i=t.value;if("undefined"===typeof IntersectionObserver)console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var r=new u(e,i,n);e._vue_visibilityState=r}}function f(e,t,n){var i=t.value,r=t.oldValue;if(!c(i,r)){var o=e._vue_visibilityState;o?o.createObserver(i,n):l(e,{value:i},n)}}function h(e){var t=e._vue_visibilityState;t&&(t.destroyObserver(),delete e._vue_visibilityState)}var d={bind:l,update:f,unbind:h};function v(e){e.directive("observe-visibility",d)}var b={version:"0.4.3",install:v},p=null;"undefined"!==typeof window?p=window.Vue:"undefined"!==typeof e&&(p=e.Vue),p&&p.use(b),t["a"]=b}).call(this,n("c8ba"))},"95d5":function(e,t,n){var i=n("40c3"),r=n("5168")("iterator"),o=n("481b");e.exports=n("584a").isIterable=function(e){var t=Object(e);return void 0!==t[r]||"@@iterator"in t||o.hasOwnProperty(i(t))}},a2f9:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"layout"},["admin"===e.role?n("div",{staticClass:"admin"},[e.isInDeletingMode||e.isAdminToolbarLoading?e._e():n("section",[n("span",{on:{click:function(t){return e.beginFileSelect()}}},[e._v("создать новость")]),n("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"fileInput"},on:{change:e.onFileSelect}}),n("span",{staticClass:"remove",on:{click:function(t){e.isInDeletingMode=!0}}},[e._v("начать удаление")])]),e.isInDeletingMode&&!e.isAdminToolbarLoading?n("section",[n("span",{on:{click:function(t){return e.cancelDeleting()}}},[e._v("отмена")]),n("span",{staticClass:"remove",on:{click:function(t){return e.deleteNews()}}},[e._v("удалить")])]):e._e(),e.isAdminToolbarLoading?n("LoadingSpinner"):e._e()],1):e._e(),e._l(e.rowedNews,function(t){return n("div",{key:t[0].id,staticClass:"news-row"},e._l(t,function(t){return n("LazyLoadImage",{key:t.id,class:{"to-delete":!!e.newsToDelete.find(function(e){return e.id===t.id})},style:{"max-height":e.height+"px"},attrs:{url:e.getFullImgURL(t)},on:{click:function(n){return e.imageClick(t)}}})}),1)}),n("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:e.onBottomReached,expression:"onBottomReached"}],staticClass:"bottom"},[e.isLoading?n("LoadingSpinner"):e._e()],1)],2)},r=[],o=n("cebc"),s=(n("7514"),n("75fc")),a=(n("96cf"),n("3b8d")),c=n("2f62"),u=n("e5e2"),l=n("cdde"),f=n("fad2"),h=n("e072"),d=n("365c"),v={uploadImg:function(e){return d["a"].protectedPostFile("/news/uploadImage",e)},getNews:function(e){return d["a"].protectedPost("/news/getNews",{itemsPerPage:e})},getMoreNews:function(e,t){return d["a"].protectedPost("/news/getMoreNews",{pageNumber:e,itemsPerPage:t})},delete:function(e){return d["a"].protectedPost("/news/delete",{id:e})}},b=n("a49b"),p=n("2b0e"),g=n("85fe");p["a"].use(g["a"]);var m=4,y={name:"Home",components:{LoadingSpinner:h["a"],LazyLoadImage:f["a"]},data:function(){return{isInDeletingMode:!1,newsToDelete:[],isLoading:!0,isAdminToolbarLoading:!1,lastPageNumber:1,hasMoreToLoad:!1,news:[],height:0}},methods:{deleteNews:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isAdminToolbarLoading=!0,this.isInDeletingMode=!1,t=0;case 3:if(!(t<this.newsToDelete.length)){e.next=13;break}return e.next=6,v.delete(this.newsToDelete[t].id);case 6:if(n=e.sent,n.ok){e.next=10;break}return alert("Произошла ошибка.\n("+n.statusCode+") "+n.statusText),e.abrupt("break",13);case 10:t++,e.next=3;break;case 13:this.newsToDelete=[],this.isAdminToolbarLoading=!1,this.loadNews();case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelDeleting:function(){this.newsToDelete=[],this.isInDeletingMode=!1},beginFileSelect:function(){document.querySelector("#fileInput").click()},onFileSelect:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isAdminToolbarLoading=!0,t=document.querySelector("#fileInput").files,n=0;case 3:if(!(n<t.length)){e.next=16;break}return e.prev=4,e.next=7,v.uploadImg(t[n]);case 7:e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](4),alert("Произошла ошибка во время загрузки "+n+" файла\n"+{e:e.t0}),this.isAdminToolbarLoading=!1;case 13:n++,e.next=3;break;case 16:return this.hasMoreToLoad=!1,this.news=[],this.isAdminToolbarLoading=!1,e.next=21,this.loadNews();case 21:case"end":return e.stop()}},e,this,[[4,9]])}));function t(){return e.apply(this,arguments)}return t}(),loadNews:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isLoading=!0,this.news=[],this.lastPageNumber=1,e.next=5,v.getNews(m);case 5:if(t=e.sent,!t.ok){e.next=12;break}return e.next=9,t.json();case 9:n=e.sent,this.news=n.data,this.hasMoreToLoad=n.hasMoreToLoad;case 12:this.isLoading=!1;case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),loadMoreNews:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.next=3,v.getMoreNews(this.lastPageNumber+1,m);case 3:if(t=e.sent,!t.ok){e.next=11;break}return e.next=7,t.json();case 7:n=e.sent,this.news=[].concat(Object(s["a"])(this.news),Object(s["a"])(n.data)),this.hasMoreToLoad=n.hasMoreToLoad,this.lastPageNumber++;case 11:this.isLoading=!1;case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getFullImgURL:function(e){return b["a"].PROTECTED_API_URL()+"/news/image/"+e.id},imageClick:function(e){if(this.isInDeletingMode){var t=this.newsToDelete.find(function(t){return t.id===e.id});t?this.newsToDelete=this.newsToDelete.filter(function(t){return t.id!==e.id}):this.newsToDelete.push(e)}else this.$eventBus.$emit(l["a"].showImagePreview,{img:this.getFullImgURL(e),height:90})},onBottomReached:function(e){!this.isLoading&&e&&this.hasNews&&this.hasMoreToLoad&&(this.hasMoreToLoad=!1,this.loadMoreNews())}},computed:Object(o["a"])({},Object(c["c"])(u["a"].user,["role"]),{rowedNews:function(){for(var e=[],t=[],n=0;n<this.news.length;n++)2===t.length&&(e.push(t),t=[]),t.push(this.news[n]),n===this.news.length-1&&e.push(t);return e},hasNews:function(){return 0!==this.news.length}}),mounted:function(){this.height=document.documentElement.clientHeight-210,this.hasNews||this.loadNews()}},w=y,k=(n("31d5"),n("2877")),x=Object(k["a"])(w,i,r,!1,null,"0de7ba24",null);t["default"]=x.exports},a745:function(e,t,n){e.exports=n("f410")},c8bb:function(e,t,n){e.exports=n("54a1")},d2d5:function(e,t,n){n("1654"),n("549b"),e.exports=n("584a").Array.from},f410:function(e,t,n){n("1af6"),e.exports=n("584a").Array.isArray},f6b5:function(e,t,n){"use strict";var i=n("3607"),r=n.n(i);r.a},fad2:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("img",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:e.onVisibilityChanged,expression:"onVisibilityChanged"}],ref:"img",style:{width:e.width+"px",height:e.height+"px"},attrs:{url:e.url},on:{click:function(t){return e.$emit("click")}}})},r=[],o=(n("c5f6"),n("cdde")),s=n("2b0e"),a=n("85fe");s["a"].use(a["a"]);var c={name:"LazyLoadImage",data:function(){return{isLoaded:!1,isVisible:!1}},props:{url:{type:String,required:!0},width:{type:Number},height:{type:Number}},methods:{callback:function(e){this.isLoaded=!0,this.$refs.img.src=e},onVisibilityChanged:function(e){this.isVisible=e,e&&!this.isLoaded&&0!==this.url.length&&this.loadImage()},loadImage:function(){this.$eventBus.$emit(o["a"].lazyLoadImage,{url:this.url,callback:this.callback,priority:1})}},watch:{url:function(e){this.isVisible&&(0!==e.length?this.loadImage():this.$refs.img.src="")}}},u=c,l=(n("f6b5"),n("2877")),f=Object(l["a"])(u,i,r,!1,null,"0ca8fe87",null);t["a"]=f.exports}}]);
//# sourceMappingURL=home.3a81d0b2.js.map